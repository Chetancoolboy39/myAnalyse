from fastapi import FastAPI, Request
from pydantic import BaseModel
from sentence_transformers import SentenceTransformer, util

app = FastAPI()

# Load model once at startup
model = SentenceTransformer("all-mpnet-base-v2")

class SimilarityRequest(BaseModel):
    text1: str
    text2: str

@app.post("/similarity")
def get_similarity_api(req: SimilarityRequest):
    emb1 = model.encode(req.text1, convert_to_tensor=True)
    emb2 = model.encode(req.text2, convert_to_tensor=True)
    similarity = util.cos_sim(emb1, emb2).item()
    return {
        "similarity": similarity,
        "covers_requirement": similarity > 0.7
    }
